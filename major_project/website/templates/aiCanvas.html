{% extends 'base.html' %}


{% block content%}

<style type="text/css">
	

	.loading-screen{
		height: 100vh;
		width: 100vw; 
		position: absolute; 
		top: 50%; 
		left: 50%; 
		transform: translate(-50%, -50%); 
		display: flex; 
		justify-content: center; 
		align-items: center;  
		background-color: rgba(32, 32, 33, 0.2); 
		backdrop-filter: blur(2px);
		visibility: hidden; 
		z-index: 150;
	}

	.loader {

	  height: 150px;
	  aspect-ratio: 2;
	  border-bottom: 3px solid #0000;
	  background: 
	    linear-gradient(90deg,gray 50%,#0000 0)
	    -25% 100%/50% 3px repeat-x border-box;
	  position: relative;
	  animation: l3-0 .75s linear infinite;

	}
	.loader:before {
	  content: "";
	  position: absolute;
	  inset: auto 42.5% 0;
	  aspect-ratio: 1;
	  border-radius: 50%;
	  background: whitesmoke;
	  animation: l3-1 .75s cubic-bezier(0,900,1,900) infinite;
	}
	@keyframes l3-0 {
	  to {background-position: -125% 100%}
	}
	@keyframes l3-1 {
	  0%,2% {bottom: 0%}
	  98%,to {bottom:.1%}
	}

</style>

<div class="loading-screen">
	<div class="loader"></div> 
</div>

<h4 style="color : white; margin-top: 23px; position: absolute; top: 1%; left: 50%; transform: translate(-50%,-50%); ">AI Canvas</h4>

<div  class="contains" style="height: 100%; width: 100vw; display: flex; flex-direction: column; justify-content: space-around; align-items: center;">
	<div style="display: flex;">
		<canvas id='board' height="500" width="1000" style="margin-left: 55px; margin-top: 20px; background-color: white; border : 4px solid Gray;  border-radius: 30px"></canvas>
		<div class="buttons" style="display: flex; margin: 10px; flex-direction: column; justify-content: center; gap: 20px; align-items: center; align-content: center;">
			<a class="btn btn-secondary button2" ><i class="bi bi-search"></i></a>
			<a class="btn btn-secondary button5" ><i class="bi bi-pen"></i></a>
			<a class="btn btn-secondary button3" ><i class="bi bi-eraser"></i></a>
			<a class="btn btn-secondary button4" ><i class="bi bi-x-circle"></i></a>
		</div>
	</div>
	<div class="response" style=" width: 66.25vw; border: 4px solid gray ; border-radius: 30px; display: flex; 
	align-items: center; justify-content: center; color: white; padding: 10px; margin: 20px;"><span class="TEXTBOX" style="font-size: 20px;"></span></div>
</div>


<script type="text/javascript">



	const canvas = document.querySelector("#board");
	const ctx = canvas.getContext("2d");
	
	let button2 = document.querySelector(".button2");
	let button3 = document.querySelector(".button3");
	let button4 = document.querySelector(".button4");
	let button5 = document.querySelector(".button5");
	let output = document.querySelector(".response");
	let submit = document.querySelector("#submit");
	let input = document.querySelector("#image");
	let textbox = document.querySelector(".TEXTBOX");
	let loadingScreen = document.querySelector(".loading-screen");


	fetch('http://127.0.0.1:8000/canvasResponse/')
    .then(response=>{
    	return response.json()
    })
    .then(data=>{
    	console.log(data)
    	textbox.innerText = data.message
    })
    .catch(error =>{
    	console.log(error)
    })

	function getCookie(name) {
	      let cookieValue = null;
	      if (document.cookie && document.cookie !== '') {
	          const cookies = document.cookie.split(';');
	          for (let i = 0; i < cookies.length; i++) {
	              const cookie = cookies[i].trim();
	              // Does this cookie string begin with the name we want?
	              if (cookie.substring(0, name.length + 1) === (name + '=')) {
	                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
	                  break;
	            }
	        }
	    }
	    return cookieValue;
	}
	

	function setCanvasBackground(color) {
      ctx.fillStyle = "white"; 
    	ctx.fillRect(0, 0, canvas.width, canvas.height); 
   	}

   setCanvasBackground('abs')

	

	button2.addEventListener("click",e=>{

		loadingScreen.style.visibility = 'visible'
		let imagedata = canvas.toDataURL("image/png")
		let data = {
            	image : imagedata,
            }
        console.log("here")
        console.log(data)

		fetch('http://127.0.0.1:8000/canvasResponse/',{
        	method : 'post',
        	headers : {
        		'X-CSRFToken' : getCookie("csrftoken"),
        	},
        	body : JSON.stringify(data)	
        })
        .then(response=>{
        	return response.json()
        })
        .then(data=>{
        	console.log(data)
        	textbox.innerText = data.message
        	loadingScreen.style.visibility = 'hidden'
        })
        .catch(error =>{
        	console.log(error)
        })


	})

	button3.addEventListener("click",e=>{
		ctx.lineWidth=20
		ctx.strokeStyle = "white";
	})

	button5.addEventListener("click",e=>{
		ctx.lineWidth=1
		ctx.strokeStyle = "black";
	})

	button4.addEventListener("click",e=>{
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		setCanvasBackground('abs');
	})

	ctx.lineWidth=1
	ctx.lineCap="round"

	

	var object = canvas.getBoundingClientRect();
	object = canvas.getBoundingClientRect()
	let drawing = false;
	
	function draw(event,x,y){
		if (drawing){
			ctx.lineTo(x,y)
			ctx.stroke()
		}
		
	}
	canvas.addEventListener("mousedown",e=>{
		ctx.beginPath()
		ctx.moveTo((e.offsetX),(e.offsetY))
		drawing=true;
		
	})
	canvas.addEventListener("mouseup",e=>{
		drawing=false;
		
	})
	canvas.addEventListener("mousemove",e=>{
		draw(e,(e.offsetX),(e.offsetY))
	})

	
</script>

{% endblock %}